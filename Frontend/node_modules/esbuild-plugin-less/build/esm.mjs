var I=Object.defineProperty,R=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var v=(e,t,s)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,L=(e,t)=>{for(var s in t||={})$.call(t,s)&&v(e,s,t[s]);if(x)for(var s of x(t))C.call(t,s)&&v(e,s,t[s]);return e},y=(e,t)=>R(e,S(t));import h from"path";import{promises as F}from"fs";import M from"less";import f from"fs";import a from"path";var E=/@import.*?["']([^"']+)["'].*?/,O=/@import.*?["']([^"']+)["'].*?/g,P=/(?:\/\*(?:[\s\S]*?)\*\/)|(\/\/(?:.*)$)/gm,D=[".css",".less"],u=(e,t=[])=>{try{let s=a.dirname(e),c=(f.readFileSync(e).toString("utf8").replace(P,"").match(O)||[]).map(r=>r.match(E)[1]).filter(r=>!!r).map(r=>{let i=a.resolve(s,a.extname(r)?r:`${r}.less`);if(!f.existsSync(i))for(let p=0;p<t.length;p++){let g=a.resolve(t[p],a.extname(r)?r:`${r}.less`);if(f.existsSync(g)){i=g;break}}return i});return c.reduce((r,i)=>[...r,...u(i,t)],c).filter(r=>D.includes(a.extname(r).toLowerCase()))}catch(s){return[]}},w=e=>{let t=e.extract.filter(l=>l),s=t.length===3?t[1]:t[0];return{text:e.message,location:{namespace:"file",file:e.filename,line:e.line,column:e.column,lineText:s}}};var A=(e={},t={})=>({name:"less-loader",setup:s=>{let l=t.filter;s.onResolve({filter:l||/\.less$/,namespace:"file"},o=>{let n=h.resolve(process.cwd(),h.relative(process.cwd(),o.resolveDir),o.path);return{path:n,watchFiles:[n,...u(n,e.paths||[])]}}),s.onLoad({filter:l||/\.less$/,namespace:"file"},async o=>{let n=await F.readFile(o.path,"utf-8"),c=h.dirname(o.path),d=y(L({filename:o.path,relativeUrls:!0},e),{paths:[...e.paths||[],c]});try{return{contents:(await M.render(n,d)).css,loader:"css",resolveDir:c}}catch(m){return{errors:[w(m)],resolveDir:c}}})}});export{A as lessLoader};
